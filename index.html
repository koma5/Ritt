<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>still to be named</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>

    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map {
            height: 100%;
            width: 100%;
        }
    </style>

</head>
<body>
    <div id="map"></div>

    <script>
    var initPosition = [51.528858, -0.220988];

    var map = L.map('map').setView(initPosition, 16);
	var Stamen_Watercolor = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}', {
		attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
		subdomains: 'abcd',
		minZoom: 1,
		maxZoom: 16,
		ext: 'jpg'
	}).addTo(map);


    var client = mqtt.connect('wss://iot.eclipse.org:443/ws')

    client.subscribe("track/latlong")

    var cyclistIcon = L.icon({
        iconUrl: 'bicyclist_1f6b4.png',
        iconSize: [35, 35],
        iconAnchor: [8, 34],
        shadowUrl: 'bicyclist_1f6b4_shadow.png',
        shadowSize: [35, 35],
        shadowAnchor: [8, 34]
    })

    var marker = L.marker(initPosition, {icon: cyclistIcon}
    ).addTo(map);


    client.on("message", function (topic, payload) {
        var [lat, lng] = payload.toString().split(',');
        console.log(lat, lng);
        marker.setLatLng(new L.LatLng(lat, lng));
        map.setView([lat, lng]);
    })

    </script>

</body>
</html>

