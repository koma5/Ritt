<!doctype html>
<html>
<head>
    <meta charset="UTF-8">
    <title>still to be named</title>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.5.1/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.5.1/dist/leaflet.js" integrity="sha512-GffPMF3RvMeYyc1LWMHtK8EbPv0iNZ8/oTtHPx9/cc2ILxQ+u905qIwdpULaqDkyBKgOaB57QTMg7ztg8Jm2Og==" crossorigin=""></script>

    <script src="https://unpkg.com/mqtt/dist/mqtt.min.js"></script>

    <style>
        body {
            padding: 0;
            margin: 0;
        }
        html, body, #map{
            height: 100%;
            width: 100%;
            display: flex;
        }

        #map {
            flex-direction:columns;
        }

        #sidebar {
            background-color: #8b6c74;
            width: 150px;
            height:100%;
            transition: width 0.3s ease-in-out;
        }

        #burger {
            position: relative;
            top: 80px;
            background-color: white;
            left: 10px;
            z-index: 10000;
            width: 30px;
            height: 30px;
            padding: 0;

        }
    </style>

</head>
<body>
    <section id="sidebar">
        <button onclick="toggleFollow()">follow</button>
    </section>
    <section id="map">
        <button id="burger" onclick="toggleSidebar()">^</button>
    </section>

    <script>
    var initPosition = [51.528858, -0.220988];
    var follow = true;

    var map = L.map('map').setView(initPosition, 16);
	var Stamen_Watercolor = L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/watercolor/{z}/{x}/{y}.{ext}', {
		attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a>, <a href="http://creativecommons.org/licenses/by/3.0">CC BY 3.0</a> &mdash; Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
		subdomains: 'abcd',
		minZoom: 1,
		maxZoom: 16,
		ext: 'jpg'
	}).addTo(map);


    var client = mqtt.connect('wss://iot.eclipse.org:443/ws')

    client.subscribe("track/latlong")

    var cyclistIcon = L.icon({
        iconUrl: 'bicyclist_1f6b4.png',
        iconSize: [35, 35],
        iconAnchor: [8, 34],
        shadowUrl: 'bicyclist_1f6b4_shadow.png',
        shadowSize: [35, 35],
        shadowAnchor: [8, 34]
    })

    var marker = L.marker(initPosition, {icon: cyclistIcon}
    ).addTo(map);


    client.on("message", function (topic, payload) {
        var [lat, lng] = payload.toString().split(',');
        console.log(lat, lng);
        marker.setLatLng(new L.LatLng(lat, lng));
        if(follow) { map.setView([lat, lng]);};
    })

    function toggleFollow() {
        follow = !follow;
    }

    function toggleSidebar() {
        element = document.getElementById('sidebar');
        if (element.style.length == 0) {
            element.style = "width:0";
        }
        else {
            element.style = '';
        }
        map.invalidateSize(); //this does not work with transitio
    }

    </script>

</body>
</html>

